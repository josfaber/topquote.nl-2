#!/bin/bash

set -e

#
WORK_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )/.."
cd $WORK_DIR

TIMESTAMP=$(date +%Y%m%d%H%M%S)

set -o allexport
source .env
set +o allexport

BACKUP_DIR="${WORK_DIR}/mount/backups/db"
mkdir -p ${BACKUP_DIR}
BACKUP_FILE_NAME="${BACKUP_DIR}/${DB_NAME}-${TIMESTAMP}.sql"

#
docker exec topquote-db bash -c \
      "exec mysqldump --no-create-db -h"db" -u"${DB_USER}" -p"${DB_PASSWORD}" ${DB_NAME}" > ${BACKUP_FILE_NAME};